<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>GpioExpander and MuxControl apps issue usage - mangOH Green - mangOH forum</title>
    <meta name="description" content="My setup is a WP7607, mangOH Green, TI WiFi WL1835MOD MirageRev3 IoT card in slot IOT0, Talon CAN IoT board in slot IOT1, and I‚Äôm using Legato R10.1. 
I have added ‚ÄúGpioExpander‚Äù (from https://github.com/mangOH/GpioExpan&amp;hellip;">
    <meta name="generator" content="Discourse 3.2.0.beta2-dev - https://github.com/discourse/discourse version 11176407155714e2ebc3885a5f3301a2b4d37c5b">
<link rel="icon" type="image/png" href="https://global.discourse-cdn.com/business6/uploads/mangoh/optimized/1X/c8f691ef20d8b5ee5eb3e88daa9a37267fd8b5c6_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="https://global.discourse-cdn.com/business6/uploads/mangoh/optimized/1X/c9436805837dffdd4ff80102c98ca366d74fee66_2_180x180.png">
<meta name="theme-color" media="all" content="#ffffff">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="https://forum.mangoh.io/t/gpioexpander-and-muxcontrol-apps-issue-usage/2597" />

<link rel="search" type="application/opensearchdescription+xml" href="https://forum.mangoh.io/opensearch.xml" title="mangOH forum Search">

    <link href="https://sea2.discourse-cdn.com/business6/stylesheets/color_definitions_mangoh-color-scheme_1_1_22c40ac3b958048f5d2773ba7c6e0a583de42cca.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" class="light-scheme"/>

  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/desktop_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="desktop"  />



  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/checklist_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="checklist"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-adplugin_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-adplugin"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-akismet_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-akismet"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-cakeday_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-data-explorer_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-data-explorer"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-details_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-footnote_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-footnote"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-lazy-videos_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-local-dates_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-narrative-bot_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-policy_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-policy"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-post-voting_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-post-voting"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-presence_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-solved_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-solved"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-spoiler-alert_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-spoiler-alert"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-templates_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-templates"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-topic-voting_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/hosted-site_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="hosted-site"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/poll_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="poll"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-post-voting_desktop_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-post-voting_desktop"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-topic-voting_desktop_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/poll_desktop_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/desktop_theme_1_ab9b3e277688d87911f25cd6e1b20eb3d4321381.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="1" data-theme-name="mangoh"/>

    
    <meta id="data-ga-universal-analytics" data-tracking-code="UA-718568-6" data-json="{&quot;cookieDomain&quot;:&quot;mangoh.io&quot;}" data-auto-link-domains="">

  <link rel="preload" href="https://global.discourse-cdn.com/business6/assets/google-universal-analytics-v3-08add7ec997ab472fcd9f821d32ff7caf4b8b9a5de2ec18ca723a040be07a098.br.js" as="script">
<script defer src="https://global.discourse-cdn.com/business6/assets/google-universal-analytics-v3-08add7ec997ab472fcd9f821d32ff7caf4b8b9a5de2ec18ca723a040be07a098.br.js"></script>


        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;GpioExpander and MuxControl apps issue usage&#39;" href="https://forum.mangoh.io/t/gpioexpander-and-muxcontrol-apps-issue-usage/2597.rss" />
    <meta property="og:site_name" content="mangOH forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://global.discourse-cdn.com/business6/uploads/mangoh/original/1X/3a6474224b6583b6512ef6a5cd02d7d66cc320b7.png" />
<meta property="og:image" content="https://global.discourse-cdn.com/business6/uploads/mangoh/original/1X/3a6474224b6583b6512ef6a5cd02d7d66cc320b7.png" />
<meta property="og:url" content="https://forum.mangoh.io/t/gpioexpander-and-muxcontrol-apps-issue-usage/2597" />
<meta name="twitter:url" content="https://forum.mangoh.io/t/gpioexpander-and-muxcontrol-apps-issue-usage/2597" />
<meta property="og:title" content="GpioExpander and MuxControl apps issue usage" />
<meta name="twitter:title" content="GpioExpander and MuxControl apps issue usage" />
<meta property="og:description" content="My setup is a WP7607, mangOH Green, TI WiFi WL1835MOD MirageRev3 IoT card in slot IOT0, Talon CAN IoT board in slot IOT1, and I‚Äôm using Legato R10.1.  I have added ‚ÄúGpioExpander‚Äù (from https://github.com/mangOH/GpioExpander) and ‚ÄúMuxControl‚Äù (from https://github.com/mangOH/MuxControl) to my Legato system as I need the ‚Äúmux‚Äù command (available when installing the MuxControl app) to correctly start the Talon CAN IoT board. I have tried to replicate the ‚Äúmux‚Äù behaviour by using the ‚Äúgpioexp‚Äù Legato..." />
<meta name="twitter:description" content="My setup is a WP7607, mangOH Green, TI WiFi WL1835MOD MirageRev3 IoT card in slot IOT0, Talon CAN IoT board in slot IOT1, and I‚Äôm using Legato R10.1.  I have added ‚ÄúGpioExpander‚Äù (from https://github.com/mangOH/GpioExpander) and ‚ÄúMuxControl‚Äù (from https://github.com/mangOH/MuxControl) to my Legato system as I need the ‚Äúmux‚Äù command (available when installing the MuxControl app) to correctly start the Talon CAN IoT board. I have tried to replicate the ‚Äúmux‚Äù behaviour by using the ‚Äúgpioexp‚Äù Legato..." />
<meta property="og:article:section" content="mangOH Green" />
<meta property="og:article:section:color" content="9EB83B" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 ‚ù§" />
<meta property="article:published_time" content="2019-04-28T13:49:45+00:00" />
<meta property="og:ignore_canonical" content="true" />


    <script type="application/ld+json">{"@context":"http://schema.org","@type":"QAPage","name":"GpioExpander and MuxControl apps issue usage","mainEntity":{"@type":"Question","name":"GpioExpander and MuxControl apps issue usage","text":"My setup is a WP7607, mangOH Green, TI WiFi WL1835MOD MirageRev3 IoT card in slot IOT0, Talon CAN IoT board in slot IOT1, and I‚Äôm using Legato R10.1.\n\nI have added ‚ÄúGpioExpander‚Äù (from <a href=\"https://github.com/mangOH/GpioExpander\" rel=\"nofollow noopener\">https://github.com/mangOH/GpioExpander<\/a>) and ‚ÄúMuxControl‚Äù (from <a href=\"https://github.com/mangOH/MuxControl\" rel=\"nofollow noopener\">https://github.com/mangOH/MuxControl<\/a>) to my Legato s&hellip;","upvoteCount":1,"answerCount":0,"dateCreated":"2019-04-28T13:49:44.886Z","author":{"@type":"Person","name":"rose"}}}</script>
  </head>
  <body class="crawler ">
    <!--
<div id="navmenucontainer" class="container">
<div id="navmenuv">
    <ul class="nav">
      <li><a href="http://mangoh.io/">Project mangOH</a></li>
      <li><a href="http://mangoh.io/mango-green.html">mangOH Green</a></li>
      <li><a href="http://mangoh.io/buy-mangoh.html">Buy</a></li>
      <li><a href="http://mangoh.io/build-your-own.html">Build your own</a></li>
    </ul>
</div>
</div>
-->
    <header>
  <a href="/">
    mangOH forum
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="/t/gpioexpander-and-muxcontrol-apps-issue-usage/2597">GpioExpander and MuxControl apps issue usage</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.mangoh.io/c/mangoh-green/6" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #9EB83B'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>mangOH Green</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='GpioExpander and MuxControl apps issue usage'>
        <meta itemprop='articleSection' content='mangOH Green'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='mangOH forum'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://global.discourse-cdn.com/business6/uploads/mangoh/original/1X/284b9ca2de433d1cdfe5448455df1b398c8cc9c8.png'>
          </div>
      </div>

          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.mangoh.io/u/MireRose'><span itemprop='name'>MireRose</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.mangoh.io/t/gpioexpander-and-muxcontrol-apps-issue-usage/2597">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2019-04-28T13:49:45Z' class='post-time'>
                    April 28, 2019,  1:49pm
                  </time>
                  <meta itemprop='dateModified' content='2019-04-28T13:49:45Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='articleBody'>
              <p>My setup is a WP7607, mangOH Green, TI WiFi WL1835MOD MirageRev3 IoT card in slot IOT0, Talon CAN IoT board in slot IOT1, and I‚Äôm using Legato R10.1.<br>
I have added ‚ÄúGpioExpander‚Äù (from <a href="https://github.com/mangOH/GpioExpander" rel="nofollow noopener">https://github.com/mangOH/GpioExpander</a>) and ‚ÄúMuxControl‚Äù (from <a href="https://github.com/mangOH/MuxControl" rel="nofollow noopener">https://github.com/mangOH/MuxControl</a>) to my Legato system as I need the ‚Äúmux‚Äù command (available when installing the MuxControl app) to correctly start the Talon CAN IoT board. I have tried to replicate the ‚Äúmux‚Äù behaviour by using the ‚Äúgpioexp‚Äù Legato system command without success, so I gave up after several days of trying.<br>
This is what I tried in the pass without success and finally end up using the ‚Äúmux 5‚Äù and ‚Äúmux 16‚Äù calls:</p>
<p>START_CAN script that is WORKING for me:</p>
<pre><code class="lang-auto">drv="can_iot.ko"
kmod unload $drv

# Output 1 to IoT slot 1 GPIO2
echo 7 &gt; /sys/class/gpio/export
echo out &gt; /sys/class/gpio/gpio7/direction
echo 1 &gt; /sys/class/gpio/gpio7/value

# Route SPI to IoT slot 1
mux 5
### gpioexp 1 1 enable
### gpioexp 1 15 output normal low
### gpioexp 1 14 output normal high

# Reset IoT slot 1
mux 16
### gpioexp 3 3 output normal high

kmod load $drv
ip link set can0 type can bitrate 125000 triple-sampling on
ifconfig can0 up
</code></pre>
<p>The issue here is that I need the ‚Äúmux‚Äù command which comes with the ‚ÄúMuxControl‚Äù app, so I also need the ‚ÄúGpioExpander‚Äù app, which I guess is conflicting the I2C access of the TIWIFI scripts available at: ‚Äú/etc/init.d/tiwifi‚Äù.<br>
The problem is that this behaviour is not deterministic, I would say that the tiwifi script to up/down the wlan0 interface works 95% of times, but not always.</p>
<p>After a clean reboot it usually works, showing the ‚ÄúmangOH green board‚Äù message, when ifup or ifdown wlan0 manually, and the 2 LEDs on the IoT0 board are switched ON of OFF correctly. This also works well then the ‚ÄúdataConnectionService‚Äù activates the WiFi interface when apply the following settings, and you initiate a connection with AirVantage or via MQTT, etc.:</p>
<pre><code class="lang-auto">$ config set dataConnectionService:/wifi/SSID "SSSSSSSSSSSS" string
$ config set dataConnectionService:/wifi/passphrase "PPPPPPPPPPPPPPPP" string
$ config set dataConnectionService:/wifi/interface wlan0 string
$ config set dataConnectionService:/wifi/wpaSupplicantDriver wext string
$ config set dataConnectionService:/wifi/secProtocol 3 int
</code></pre>
<p>BUT, after few minutes of using my app, where then the GpioExpanderServiceGreen service and RAW le_gpio APIs calls are used to manage some status LEDs, if there is a network disconnection (for any reason) and the ‚ÄúdataConnectionService‚Äù tries to start the TI WiFi again, it fails!.<br>
After that point the tiwifi script doesn‚Äôt work correctly any more, no matter if you call ifdown wlan0 or ifup wlan0 manually, or whatever you try.<br>
In particular the ‚Äúgpioexp 3 4 output normal low‚Äù line fails accessing the I2C at address 0x70 (address of Expander3, port 4), and then the script enters in the ‚ÄúmangOH red board‚Äù side of the IF, failing to deselect the SDIO_SEL line and reset the IOT0_GPIO2 line‚Ä¶<br>
If I stop my TUNIT app at that point and call the following, I could recover:</p>
<pre><code class="lang-auto">root@swi-mdm9x28-wp:~# ifdown wlan0
mangOH red board
sh: write error: Operation not permitted
ERR* failed to read i2c data
ERR* I2c get addr 0x3e value failureERR* Set mode 0 failureERR* failed to read i2c data
ERR* I2c get addr 0x3e value failureERR* Set polarity 0 failure
ERR* failed to read i2c data
ERR* I2c get addr 0x3e value failureERR* Set output 1 failure
root@swi-mdm9x28-wp:~# ifup wlan0
mangOH green board
root@swi-mdm9x28-wp:~# ifdown wlan0
mangOH green board
</code></pre>
<p>But with the TUNIT app running (using the GpioExpanderServiceGreen service) I guess there is no way to recover from this situation.<br>
So, for me it would be desirable if I could avoid the use of the GpioExpanderServiceGreen and MuxControl at all by my application, that I guess they are creating the conflict after a while with the I2C ports (called from the ‚Äúgpioexp‚Äù command called by the ‚Äútiwifi‚Äù script), but I didn‚Äôt find the way to avoid them safetly (as I need the mux command for starting the CAN IoT1 side).<br>
QUESTION:<br>
Any recommendation to access the GpioExpander chips more safetly way from my application without using the 3rd-party ‚ÄúGpioExpander‚Äù and ‚ÄúMuxControl‚Äù apps which I guess they are conflicting the ‚Äúgpioexp‚Äù system command (needed by the tiwifi driver)?.</p>
<p>Regards</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

          </div>
    </div>






    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='/guidelines' itemprop="url">FAQ/Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
