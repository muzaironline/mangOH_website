<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Communicate with an external hardware which is connected with the mangOH - mangOH Green - mangOH forum</title>
    <meta name="description" content="Hello, 
I am trying to communicate with an external hardware which is connected with the mangOH through the IOT Breakout Board (IOT 0) using SPI. I am able to initialize the SPI but I am not able to send anything using t&amp;hellip;">
    <meta name="generator" content="Discourse 3.2.0.beta2-dev - https://github.com/discourse/discourse version 11176407155714e2ebc3885a5f3301a2b4d37c5b">
<link rel="icon" type="image/png" href="https://global.discourse-cdn.com/business6/uploads/mangoh/optimized/1X/c8f691ef20d8b5ee5eb3e88daa9a37267fd8b5c6_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="https://global.discourse-cdn.com/business6/uploads/mangoh/optimized/1X/c9436805837dffdd4ff80102c98ca366d74fee66_2_180x180.png">
<meta name="theme-color" media="all" content="#ffffff">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="https://forum.mangoh.io/t/communicate-with-an-external-hardware-which-is-connected-with-the-mangoh/1082" />

<link rel="search" type="application/opensearchdescription+xml" href="https://forum.mangoh.io/opensearch.xml" title="mangOH forum Search">

    <link href="https://sea2.discourse-cdn.com/business6/stylesheets/color_definitions_mangoh-color-scheme_1_1_22c40ac3b958048f5d2773ba7c6e0a583de42cca.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" class="light-scheme"/>

  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/desktop_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="desktop"  />



  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/checklist_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="checklist"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-adplugin_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-adplugin"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-akismet_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-akismet"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-cakeday_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-data-explorer_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-data-explorer"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-details_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-footnote_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-footnote"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-lazy-videos_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-local-dates_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-narrative-bot_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-policy_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-policy"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-post-voting_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-post-voting"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-presence_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-solved_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-solved"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-spoiler-alert_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-spoiler-alert"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-templates_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-templates"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-topic-voting_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/hosted-site_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="hosted-site"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/poll_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="poll"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-post-voting_desktop_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-post-voting_desktop"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/discourse-topic-voting_desktop_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/poll_desktop_fbfeae940828649b0abf03cf5cf6eebbf6949dd1.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://sea2.discourse-cdn.com/business6/stylesheets/desktop_theme_1_ab9b3e277688d87911f25cd6e1b20eb3d4321381.css?__ws=forum.mangoh.io" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="1" data-theme-name="mangoh"/>

    
    <meta id="data-ga-universal-analytics" data-tracking-code="UA-718568-6" data-json="{&quot;cookieDomain&quot;:&quot;mangoh.io&quot;}" data-auto-link-domains="">

  <link rel="preload" href="https://global.discourse-cdn.com/business6/assets/google-universal-analytics-v3-08add7ec997ab472fcd9f821d32ff7caf4b8b9a5de2ec18ca723a040be07a098.br.js" as="script">
<script defer src="https://global.discourse-cdn.com/business6/assets/google-universal-analytics-v3-08add7ec997ab472fcd9f821d32ff7caf4b8b9a5de2ec18ca723a040be07a098.br.js"></script>


        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Communicate with an external hardware which is connected with the mangOH&#39;" href="https://forum.mangoh.io/t/communicate-with-an-external-hardware-which-is-connected-with-the-mangoh/1082.rss" />
    <meta property="og:site_name" content="mangOH forum" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://global.discourse-cdn.com/business6/uploads/mangoh/original/1X/3a6474224b6583b6512ef6a5cd02d7d66cc320b7.png" />
<meta property="og:image" content="https://global.discourse-cdn.com/business6/uploads/mangoh/original/1X/3a6474224b6583b6512ef6a5cd02d7d66cc320b7.png" />
<meta property="og:url" content="https://forum.mangoh.io/t/communicate-with-an-external-hardware-which-is-connected-with-the-mangoh/1082" />
<meta name="twitter:url" content="https://forum.mangoh.io/t/communicate-with-an-external-hardware-which-is-connected-with-the-mangoh/1082" />
<meta property="og:title" content="Communicate with an external hardware which is connected with the mangOH" />
<meta name="twitter:title" content="Communicate with an external hardware which is connected with the mangOH" />
<meta property="og:description" content="Hello,  I am trying to communicate with an external hardware which is connected with the mangOH through the IOT Breakout Board (IOT 0) using SPI. I am able to initialize the SPI but I am not able to send anything using the SPI. I used an oscilloscope(http://www.kynix.com/Product/Cate/744.html) (meassured on the CLK) to see if anything is sent, but only the le_spi_Configure displayed something on the oscilloscope, but I wasn’t able to see something when I send something.  I did the same with a se..." />
<meta name="twitter:description" content="Hello,  I am trying to communicate with an external hardware which is connected with the mangOH through the IOT Breakout Board (IOT 0) using SPI. I am able to initialize the SPI but I am not able to send anything using the SPI. I used an oscilloscope(http://www.kynix.com/Product/Cate/744.html) (meassured on the CLK) to see if anything is sent, but only the le_spi_Configure displayed something on the oscilloscope, but I wasn’t able to see something when I send something.  I did the same with a se..." />
<meta property="og:article:section" content="mangOH Green" />
<meta property="og:article:section:color" content="9EB83B" />
<meta property="article:published_time" content="2018-01-16T06:48:11+00:00" />
<meta property="og:ignore_canonical" content="true" />


    <script type="application/ld+json">{"@context":"http://schema.org","@type":"QAPage","name":"Communicate with an external hardware which is connected with the mangOH","mainEntity":{"@type":"Question","name":"Communicate with an external hardware which is connected with the mangOH","text":"Hello,\n\nI am trying to communicate with an external hardware which is connected with the mangOH through the IOT Breakout Board (IOT 0) using SPI. I am able to initialize the SPI but I am not able to send anything using the SPI. I used an oscilloscope(<a href=\"http://www.kynix.com/Product/Cate/744.html\" rel=\"nofollow noopener\">http://www.kynix.com/Product/Cate/744.html<\/a>) (meas&hellip;","upvoteCount":0,"answerCount":0,"dateCreated":"2018-01-16T06:48:11.372Z","author":{"@type":"Person","name":"Helen Wang"}}}</script>
  </head>
  <body class="crawler ">
    <!--
<div id="navmenucontainer" class="container">
<div id="navmenuv">
    <ul class="nav">
      <li><a href="http://mangoh.io/">Project mangOH</a></li>
      <li><a href="http://mangoh.io/mango-green.html">mangOH Green</a></li>
      <li><a href="http://mangoh.io/buy-mangoh.html">Buy</a></li>
      <li><a href="http://mangoh.io/build-your-own.html">Build your own</a></li>
    </ul>
</div>
</div>
-->
    <header>
  <a href="/">
    mangOH forum
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="/t/communicate-with-an-external-hardware-which-is-connected-with-the-mangoh/1082">Communicate with an external hardware which is connected with the mangOH</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.mangoh.io/c/mangoh-green/6" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #9EB83B'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>mangOH Green</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Communicate with an external hardware which is connected with the mangOH'>
        <meta itemprop='articleSection' content='mangOH Green'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='mangOH forum'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://global.discourse-cdn.com/business6/uploads/mangoh/original/1X/284b9ca2de433d1cdfe5448455df1b398c8cc9c8.png'>
          </div>
      </div>

          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.mangoh.io/u/Peykey'><span itemprop='name'>Peykey</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.mangoh.io/t/communicate-with-an-external-hardware-which-is-connected-with-the-mangoh/1082">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-01-16T06:48:11Z' class='post-time'>
                    January 16, 2018,  6:48am
                  </time>
                  <meta itemprop='dateModified' content='2018-01-16T06:48:11Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='articleBody'>
              <p>Hello,</p>
<p>I am trying to communicate with an external hardware which is connected with the mangOH through the IOT Breakout Board (IOT 0) using SPI. I am able to initialize the SPI but I am not able to send anything using the SPI. I used an oscilloscope(<a href="http://www.kynix.com/Product/Cate/744.html" rel="nofollow noopener">http://www.kynix.com/Product/Cate/744.html</a>) (meassured on the CLK) to see if anything is sent, but only the le_spi_Configure displayed something on the oscilloscope, but I wasn’t able to see something when I send something.</p>
<p>I did the same with a second WP8548 which is based on an older Firmware without the spiService (and with the spi_sierra). On the older implementation, I had no problem to see the clock meassured with an oscilloscope (If required, I can post it too).</p>
<p>I think the problem is the spiService?! I hope somebody has an idea how I could fix this problem. Thanks!</p>
<p>(There is also a SPITest on the mangOH Github page which looks similar to the following code: <a href="https://github.com/mangOH/SpiTest3" rel="nofollow noopener">https://github.com/mangOH/SpiTest3</a>)</p>
<p>On my WP8548 is FW14 installed and kernelmodules are loaded and the /dev/spidev0.0 is available:</p>
<pre><code>root@swi-mdm9x15:~# lsmod | grep "spi*"
spisvc 694 0 - Live 0xbf07b000 (O)
spidev 6076 2 - Live 0xbf076000
</code></pre>
<p>Furthermore the spiService is running.<br>
My programm looks like this:</p>
<pre><code>#include "legato.h"
#include "interfaces.h"

/**
 * Handle for passing to related functions to access the SPI device
 */
static le_spi_DeviceHandleRef_t spiHandle = NULL;

void spi_open()
{
	le_result_t res_open; //Stores the error of le_spi_Open()
	int32_t mode = 3; //Set SPI mode 3
	uint8_t bits = 8; //Set 8 bits per word
	uint32_t speed = 96000; //Set max speed to 96khz
	int32_t msb = 0; //Set as 0 for MSB as first bit

	LE_DEBUG("Open SPI device");
	res_open = le_spi_Open("spidev0.0", &amp;spiHandle);
	if (res_open == LE_OK)
	{
		LE_DEBUG("SPI opened on device %s", device_name);
	}
	else
	{
		LE_ERROR("le_spi_Open failed to open %s with result=%s", device_name, LE_RESULT_TXT(res_open));
	}

	le_spi_Configure(spiHandle, mode, bits, speed, msb);
}

/**
 * Initialize the SPI
 */
void spi_init()
{
	le_result_t res_write; //Stores the error of le_spi_WriteHD()
	const uint8_t activate_spi[4] = {0x00, 0xEB, 0xFF, 0x00}; //Write 0x00 to address 0xEBFF to activate ADE7878

	//activate_spi has to be sent 3 times to activate ADE7878
	for(int i = 0; i &lt; 3; i++)
	{
		res_write = le_spi_WriteHD(spiHandle, activate_spi, NUM_ARRAY_MEMBERS(activate_spi));
		if (res_write != LE_OK)
		{
			LE_ERROR("le_spi_WriteHD failed on iteration %d with result=%s", i + 1, LE_RESULT_TXT(res_write));
		}
	}

	//Read Checksum Register the check whether connection has been opened successful
	le_result_t res_read;
	const uint8_t read_checksum[] = {0x01, 0xE5, 0x1f};
	uint8_t read_result[4];
	size_t read_result_size = NUM_ARRAY_MEMBERS(read_result);

	LE_INFO("Started to read...");
	res_read = le_spi_WriteReadHD(spiHandle, read_checksum, NUM_ARRAY_MEMBERS(read_checksum),
	read_result, &amp;read_result_size);

	if (res_read == LE_OK)
	{
		if (read_checksum[3] == 0x33 &amp;&amp; read_checksum[4] == 0x66 &amp;&amp; read_checksum[5] == 0x67 &amp;&amp; read_checksum[6] == 0x87)
		{
			LE_DEBUG("ADE7878 checksum read - Checksum: %d %d %d %d \n", read_result[0], read_result[1], read_result[2], read_result[3]);
		}
		else
		{
			LE_DEBUG("Error opening SPI connection - Checksum: %d %d %d %d \n", read_result[0], read_result[1], read_result[2], read_result[3]);
		}
	}
	else
	{
		LE_ERROR("le_spi_ReadHD failed with result=%s", LE_RESULT_TXT(res_read));
	}
}

COMPONENT_INIT
{
	spi_open();
	spi_init();
}
</code></pre>
<p>My Component.cdef looks like this:<br>
<code>sources: { SPITestComponent.c } requires: { api: { le_spi = ${LEGATO_ROOT}/interfaces/le_spi.api } }</code></p>
<p>And my SPITest.adef like this:</p>
<pre><code>version: 1.0.0
sandboxed: false
start: manual
bindings:
{
spitest.SPITestComponent.le_spi -&gt; spiService.le_spi
}
maxFileSystemBytes: 512K
executables:
{
spitest = ( SPITestComponent )
}
processes:
{
envVars:
{
LE_LOG_LEVEL = DEBUG
}
run:
{
( spitest )
}
maxCoreDumpFileBytes: 512K
maxFileBytes: 512K
}
</code></pre>
<p>I get the following output:</p>
<pre><code>Jun 8 12:18:12 | supervisor[500]/supervisor T=main | resourceLimits.c SetRLimitValue() 282 | Setting resource limit maxCoreDumpFileBytes to value 524288.
Jun 8 12:18:12 | supervisor[500]/supervisor T=main | resourceLimits.c SetRLimitValue() 282 | Setting resource limit maxFileBytes to value 524288.
Jun 8 12:18:12 | supervisor[500]/supervisor T=main | resourceLimits.c SetRLimitValue() 282 | Setting resource limit maxLockedMemoryBytes to value 8192.
Jun 8 12:18:12 | supervisor[500]/supervisor T=main | resourceLimits.c SetRLimitValue() 282 | Setting resource limit maxFileDescriptors to value 256.
Jun 8 12:18:12 | supervisor[500]/supervisor T=main | resourceLimits.c SetRLimitValue() 282 | Setting resource limit maxMQueueBytes to value 512.
Jun 8 12:18:12 | supervisor[500]/supervisor T=main | resourceLimits.c SetRLimitValue() 282 | Setting resource limit maxThreads to value 20.
Jun 8 12:18:12 | supervisor[500]/supervisor T=main | resourceLimits.c SetRLimitValue() 282 | Setting resource limit maxQueuedSignals to value 100.
Jun 8 12:18:12 | supervisor[500]/supervisor T=main | proc.c proc_Start() 1190 | Starting process 'spitest' with pid 3665
Jun 8 12:18:12 | supervisor[3665]/supervisor T=main | proc.c proc_Start() 1155 | Execing 'spitest'
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=unknown | LE_FILENAME InitPool() 303 | Memory pool name 'framework.hashMap_refPathIteratorMap' is truncated to 'framework.hashMap_refPathIterat'
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=main | LE_FILENAME InitPool() 303 | Memory pool name 'framework.hashMap_refEventHandlers' is truncated to 'framework.hashMap_refEventHandl'
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=main | LE_FILENAME InitPool() 303 | Memory pool name 'framework.hashMap_refDefault Timer SafeRe' is truncated to 'framework.hashMap_refDefault Ti'
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=main | LE_FILENAME InitPool() 303 | Memory pool name 'framework.MessagingClientInterfaces' is truncated to 'framework.MessagingClientInterf'
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=main | LE_FILENAME InitPool() 303 | Memory pool name 'framework.hashMap_refHandlersRef' is truncated to 'framework.hashMap_refHandlersRe'
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=main | LE_FILENAME InitPool() 303 | Memory pool name 'framework.hashMap_MessagingServices' is truncated to 'framework.hashMap_MessagingServ'
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=main | LE_FILENAME InitPool() 303 | Memory pool name 'framework.hashMap_MessagingClients' is truncated to 'framework.hashMap_MessagingClie'
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=main | LE_FILENAME InitPool() 303 | Memory pool name 'framework.PipelineSIGCHLD-reports' is truncated to 'framework.PipelineSIGCHLD-repor'
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=main | LE_FILENAME le_mem_ForceAlloc() 841 | Memory pool 'framework.DestructorObjs' overflowed. Expanded to 1 blocks.
Jun 8 12:18:12 | UNKNOWN[3665]/ T=main | componentMain.c _SPITestComponentInit() 29 | Initializing SPITestComponent component library.
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=main | LE_FILENAME InitPool() 303 | Memory pool name 'framework.hashMap_refle_spi_ClientHandler' is truncated to 'framework.hashMap_refle_spi_Cli'
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=main | LE_FILENAME msgMessage_CreatePool() 112 | Pool name truncated to 'msgs-87787d2f610390791c34d1db20' for protocol '87787d2f610390791c34d1db20b78ef7'.
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=main | LE_FILENAME InitPool() 303 | Memory pool name 'framework.msgs-87787d2f610390791c34d1db20' is truncated to 'framework.msgs-87787d2f61039079'
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=main | LE_FILENAME le_mem_ForceAlloc() 841 | Memory pool '.le_spi_ClientThreadData' overflowed. Expanded to 1 blocks.
Jun 8 12:18:12 | UNKNOWN[3665]/framework T=main | le_spi_client.c DoConnectService() 391 | ======= Starting client for 'spitest.SPITestComponent.le_spi' service ========
Jun 8 12:18:12 | spitest[3665]/framework T=main | LE_FILENAME InitPool() 303 | Memory pool name 'framework.msgs-LogControlProtocol' is truncated to 'framework.msgs-LogControlProtoc'
Jun 8 12:18:12 | spitest[3665]/spitest_exe T=main | _main.c main() 56 | == Starting Event Processing Loop ==
Jun 8 12:18:12 | spitest[3665]/SPITestComponent T=main | SPITestComponent.c spi_open() 31 | Open SPI device
Jun 8 12:18:12 | spitest[3665]/framework T=main | le_spi_client.c le_spi_Open() 560 | Sending message to server and waiting for response : 13 bytes sent
Jun 8 12:18:12 | spitest[3665]/SPITestComponent T=main | SPITestComponent.c spi_open() 35 | SPI opened on device spidev0.0
Jun 8 12:18:12 | spitest[3665]/framework T=main | le_spi_client.c le_spi_Configure() 705 | Sending message to server and waiting for response : 17 bytes sent
Jun 8 12:18:12 | spitest[3665]/framework T=main | le_spi_client.c le_spi_WriteHD() 848 | Sending message to server and waiting for response : 12 bytes sent
Jun 8 12:18:12 | spitest[3665]/framework T=main | le_spi_client.c le_spi_WriteHD() 848 | Sending message to server and waiting for response : 12 bytes sent
Jun 8 12:18:12 | spitest[3665]/framework T=main | le_spi_client.c le_spi_WriteHD() 848 | Sending message to server and waiting for response : 12 bytes sent
Jun 8 12:18:12 | spitest[3665]/SPITestComponent T=main | SPITestComponent.c spi_init() 74 | Started to read...
Jun 8 12:18:12 | spitest[3665]/framework T=main | le_spi_client.c le_spi_WriteReadHD() 777 | Sending message to server and waiting for response : 15 bytes sent
Jun 8 12:18:12 | spitest[3665]/SPITestComponent T=main | SPITestComponent.c spi_init() 88 | Error opening SPI connection - Checksum: 0 0 0 0</code></pre>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.mangoh.io/u/dfrey'><span itemprop='name'>dfrey</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.mangoh.io/t/communicate-with-an-external-hardware-which-is-connected-with-the-mangoh/1082">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-01-16T22:37:07Z' class='post-time'>
                    January 16, 2018, 10:37pm
                  </time>
                  <meta itemprop='dateModified' content='2018-01-16T22:37:07Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I read through the code and I didn’t identify any problems.  Maybe remove your SPI device from the system and see if loopback works when you connect MOSI and MISO and perform a WriteReadFD</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.mangoh.io/u/bv321'><span itemprop='name'>bv321</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.mangoh.io/t/communicate-with-an-external-hardware-which-is-connected-with-the-mangoh/1082">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2019-05-02T04:19:44Z' class='post-time'>
                    May 2, 2019,  4:19am
                  </time>
                  <meta itemprop='dateModified' content='2019-05-02T04:19:44Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I have this exact problem. Were you able to resolve it?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.mangoh.io/u/tqkieu'><span itemprop='name'>tqkieu</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.mangoh.io/t/communicate-with-an-external-hardware-which-is-connected-with-the-mangoh/1082">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2019-05-07T04:36:26Z' class='post-time'>
                    May 7, 2019,  4:36am
                  </time>
                  <meta itemprop='dateModified' content='2019-05-07T04:36:26Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hi <a class="mention" href="/u/peykey">@PeyKey</a>,</p>
<p>I found some problem with your code.</p>
<ol>
<li>
<p>Refer to the <a href="https://source.sierrawireless.com/resources/airprime/hardware_specs_user_guides/airprime_wp75xx_wp8548_product_technical_specification/" rel="nofollow noopener">WP8548 PTS</a>, the lowest speed supported by SPI bus is 960kbps. Your code sets the speed 96kbps, this will not effect and the lowest speed (960kbps) will be chosen. Maybe your device (ADE7878) cannot work with this speed.</p>
</li>
<li>
<p>The error message in the log come from these lines</p>
<pre><code> 	if (read_checksum[3] == 0x33 &amp;&amp; read_checksum[4] == 0x66 &amp;&amp; read_checksum[5] == 0x67 &amp;&amp; read_checksum[6] == 0x87)
 	{
 		LE_DEBUG("ADE7878 checksum read - Checksum: %d %d %d %d \n", read_result[0], read_result[1], read_result[2], read_result[3]);
 	}
 	else
 	{
 		LE_DEBUG("Error opening SPI connection - Checksum: %d %d %d %d \n", read_result[0], read_result[1], read_result[2], read_result[3]);
 	}
</code></pre>
</li>
</ol>
<p>You’ve used out of range “read_checksum” buffer<br>
<code>const uint8_t read_checksum[] = {0x01, 0xE5, 0x1f};</code><br>
I think you want to check “read_result” buffer instead.</p>
<p>Hope this help.<br>
Kieu</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

          </div>
    </div>






    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='/guidelines' itemprop="url">FAQ/Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
